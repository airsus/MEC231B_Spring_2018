function [dx] = bicycle_model_nonlin_dyn(t,x,u,params)
% function defining the nonlinear bicyle model for vehicle dynamics
dx = f(x,u)
%% unpacking parameters
% vehicle parameters
m = params.m;
Jz = params.Jz;
a = params.a;
b = params.b;
% tire model parameters
A = params.A;
B = params.B;
C = params.C;

%% extracting states and inputs
[vx, vy, wz, X, Y, psi] = deal(x(1), x(2), x(3), x(4), x(5), x(6));
Fx = u(1);
delta = (u(2));
%% dynamics
% slip angles
if vx ~= 0
af = atan((vy+a*wz)/vx) - delta;
ar = atan((vy-b*wz)/vx);
else
af=0; ar=0;
end
dvx = vy*wz - (2*Ff(af)*sin(delta))/m + Fx/m;
dvy
dw
